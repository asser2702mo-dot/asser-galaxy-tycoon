<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ASSER GALAXY V38 - PRECISE BALANCE</title>
    <style>
        :root { --blue: #00f2ff; --gold: #ffd700; --red: #ff0044; }
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; color: white; touch-action: none; user-select: none; }
        
        .screen { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #001, #000); z-index: 1000; }
        .garage { display: flex; gap: 10px; margin: 20px 0; }
        .ship-box { border: 2px solid #444; padding: 8px; border-radius: 12px; width: 75px; text-align: center; background: rgba(255,255,255,0.05); }
        .ship-box.active { border-color: var(--blue); box-shadow: 0 0 15px var(--blue); transform: scale(1.05); }
        
        .btn { padding: 12px 30px; background: var(--blue); border: none; border-radius: 50px; font-weight: bold; color: #000; cursor: pointer; font-size: 16px; margin: 5px; }
        .btn:disabled { background: #555; color: #ccc; }

        #ui { position: absolute; top: 15px; width: 100%; display: none; justify-content: space-around; z-index: 500; font-weight: bold; }
        
        #player { position: absolute; bottom: 120px; z-index: 200; display: flex; align-items: center; justify-content: center; }
        .aura { position: absolute; width: 130%; height: 130%; border: 2px solid var(--blue); border-radius: 50%; opacity: 0.3; filter: blur(4px); }

        .bullet { position: absolute; background: #fff; box-shadow: 0 0 10px var(--blue); border-radius: 5px; transform: translateX(-50%); }
        .enemy { position: absolute; width: 65px; height: 65px; z-index: 100; }
        
        .boss { position: absolute; z-index: 110; display: flex; flex-direction: column; align-items: center; }
        .hp-bar { width: 180px; height: 12px; background: #333; border: 1px solid #fff; border-radius: 6px; overflow: hidden; margin-bottom: 5px; }
        .hp-fill { height: 100%; background: var(--red); width: 100%; transition: width 0.1s; }
        .boss-art { font-size: 70px; filter: drop-shadow(0 0 15px var(--red)); }

        #controls { position: absolute; bottom: 30px; width: 100%; display: none; justify-content: center; gap: 40px; z-index: 2000; }
        .ctrl-btn { width: 80px; height: 80px; background: rgba(255,255,255,0.1); border: 2px solid var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; }
    </style>
</head>
<body>

<div id="lobby" class="screen">
    <h1 style="color: var(--blue); margin: 0; font-size: 28px;">ASSER GALAXY V38</h1>
    <div style="color: var(--gold); margin: 10px 0;">üí∞ BANK: <span id="bank-val">0</span> | STAGE: <span id="stage-val">1</span></div>
    <div class="garage" id="garage"></div>
    <button id="up-btn" class="btn" onclick="upgrade()">UPGRADE (500 üí∞)</button>
    <button class="btn" style="background: var(--gold);" onclick="startGame()">START MISSION</button>
</div>

<div id="win-screen" class="screen" style="display:none;">
    <h1 style="color: var(--gold);">VICTORY!</h1>
    <p id="win-msg" style="font-size: 20px;"></p>
    <button class="btn" onclick="location.reload()">NEXT STAGE</button>
</div>

<div id="ui">
    <div id="lives-ui"></div>
    <div style="color: var(--gold);">üí∞ <span id="sess-coins">0</span></div>
    <div style="color: var(--blue);">ST: <span id="sess-stage">1</span></div>
</div>

<div id="player" style="display:none;"></div>
<div id="controls"><div class="ctrl-btn" id="lBtn">‚¨ÖÔ∏è</div><div class="ctrl-btn" id="rBtn">‚û°Ô∏è</div></div>

<script>
    const shipBases = [
        `<svg viewBox="0 0 100 100"><polygon points="50,5 95,95 50,75 5,95" fill="#00f2ff"/><rect x="45" y="40" width="10" height="30" fill="#fff"/></svg>`,
        `<svg viewBox="0 0 100 100"><path d="M50 5 L100 80 L80 100 L50 80 L20 100 L0 80 Z" fill="#ffd700"/><circle cx="50" cy="50" r="10" fill="#fff"/></svg>`,
        `<svg viewBox="0 0 100 100"><path d="M10 20 L50 0 L90 20 L90 80 L50 100 L10 80 Z" fill="#fff"/><circle cx="50" cy="50" r="15" fill="#00f2ff"/></svg>`
    ];

    const bossIcons = ["üíÄ", "üëΩ", "üëª", "üëπ", "ü§ñ", "üëæ", "üêâ"];

    let state = {
        coins: parseInt(localStorage.getItem('as_v38_c')) || 0,
        stage: parseInt(localStorage.getItem('as_v38_s')) || 1,
        shipId: parseInt(localStorage.getItem('as_v38_i')) || 0,
        lvls: JSON.parse(localStorage.getItem('as_v38_l')) || [1, 1, 1]
    };

    let active = false, lives = 5, sessCoins = 0, kills = 0, isBoss = false, px = 50, bx = 50, bd = 1;

    function save() {
        localStorage.setItem('as_v38_c', state.coins);
        localStorage.setItem('as_v38_s', state.stage);
        localStorage.setItem('as_v38_i', state.shipId);
        localStorage.setItem('as_v38_l', JSON.stringify(state.lvls));
        updateLobbyUI();
    }

    function updateLobbyUI() {
        document.getElementById('bank-val').innerText = state.coins;
        document.getElementById('stage-val').innerText = state.stage;
        const curLvl = state.lvls[state.shipId];
        const upBtn = document.getElementById('up-btn');
        if(curLvl >= 15) { upBtn.innerText = "MAX LEVEL"; upBtn.disabled = true; }
        else {
            const cost = 500 + (curLvl - 1) * 100;
            upBtn.innerText = `UPGRADE (${cost} üí∞)`;
            upBtn.disabled = false;
        }
        renderGarage();
    }

    function renderGarage() {
        document.getElementById('garage').innerHTML = shipBases.map((s, i) => `
            <div class="ship-box ${state.shipId==i?'active':''}" onclick="state.shipId=${i};updateLobbyUI();">
                <div style="width:35px;height:35px;margin:auto">${s}</div>
                <div style="font-size:12px">Lv ${state.lvls[i]}</div>
            </div>`).join('');
    }

    function upgrade() {
        const curLvl = state.lvls[state.shipId];
        const cost = 500 + (curLvl - 1) * 100;
        if(state.coins >= cost && curLvl < 15) { state.coins -= cost; state.lvls[state.shipId]++; save(); }
    }

    function startGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('ui').style.display = 'flex';
        document.getElementById('controls').style.display = 'flex';
        updatePlayerLook();
        active = true; lives = 5 + Math.floor(state.lvls[state.shipId]/2);
        sessCoins = 0; kills = 0; isBoss = false; px = 50;
        updateUI(); spawnEnemy(); shoot();
    }

    function updatePlayerLook() {
        const p = document.getElementById('player');
        const level = state.lvls[state.shipId];
        const size = 55 + (level * 4); 
        p.style.display = 'flex'; p.style.width = size + 'px'; p.style.height = size + 'px';
        p.innerHTML = (level > 4 ? `<div class="aura"></div>` : '') + shipBases[state.shipId];
    }

    function updateUI() {
        document.getElementById('lives-ui').innerText = "‚ù§Ô∏è" + lives;
        document.getElementById('sess-coins').innerText = sessCoins;
        document.getElementById('sess-stage').innerText = state.stage;
    }

    function shoot() {
        if(!active) return;
        const level = state.lvls[state.shipId];
        const b = document.createElement('div'); b.className = 'bullet';
        b.style.width = (5 + level * 1.2) + 'px'; b.style.height = (25 + level * 2) + 'px';
        const r = document.getElementById('player').getBoundingClientRect();
        b.style.left = (r.left + r.width/2) + 'px'; b.style.bottom = (window.innerHeight - r.top) + 'px';
        document.body.appendChild(b);

        let m = setInterval(() => {
            let y = parseFloat(b.style.bottom); b.style.bottom = (y + 20) + 'px';
            document.querySelectorAll('.enemy, .boss').forEach(t => {
                let tR = t.getBoundingClientRect(); let bR = b.getBoundingClientRect();
                if(bR.left < tR.right && bR.right > tR.left && bR.top < tR.bottom && bR.bottom > tR.top) {
                    if(t.classList.contains('boss')) {
                        t.hp -= (level * 5);
                        t.querySelector('.hp-fill').style.width = (t.hp/t.max*100)+'%';
                        if(t.hp <= 0) { 
                            t.remove(); active = false;
                            state.coins += (sessCoins + 750); state.stage++; save();
                            document.getElementById('win-screen').style.display='flex';
                            document.getElementById('win-msg').innerText = "Reward: 750 üí∞";
                        }
                    } else {
                        t.remove(); sessCoins += 50; kills++; updateUI();
                        if(kills === 8) spawnBoss(); 
                    }
                    b.remove(); clearInterval(m);
                }
            });
            if(y > window.innerHeight) { b.remove(); clearInterval(m); }
        }, 20);
        setTimeout(shoot, Math.max(70, 450 - (level * 55)));
    }

    function spawnEnemy() {
        if(!active || isBoss) return;
        const e = document.createElement('div'); e.className = 'enemy';
        e.innerHTML = `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#ff0044" stroke="#fff" stroke-width="3"/><circle cx="35" cy="50" r="5" fill="#000"/><circle cx="65" cy="50" r="5" fill="#000"/><path d="M35 80 Q50 65 65 80" fill="none" stroke="#000" stroke-width="5"/></svg>`;
        e.style.left = Math.random() * 80 + 'vw'; e.style.top = '-100px';
        document.body.appendChild(e);
        let m = setInterval(() => {
            if(!active) { e.remove(); clearInterval(m); return; }
            let t = parseFloat(e.style.top); e.style.top = (t + 3.5 + (state.stage * 0.4)) + 'px';
            let pR = document.getElementById('player').getBoundingClientRect();
            let eR = e.getBoundingClientRect();
            if(eR.left < pR.right && eR.right > pR.left && eR.top < pR.bottom && eR.bottom > pR.top) {
                lives--; updateUI(); e.remove(); clearInterval(m); if(lives <= 0) location.reload();
            }
            if(t > window.innerHeight) { e.remove(); clearInterval(m); spawnEnemy(); }
        }, 20);
        setTimeout(spawnEnemy, Math.max(500, 1800 - (state.stage * 100)));
    }

    function spawnBoss() {
        isBoss = true;
        const b = document.createElement('div'); b.className = 'boss';
        
        // --- ÿ™ÿπÿØŸäŸÑ ÿ¢ÿ≥ÿ±: ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿµÿ≠ÿ© 15% ŸÉŸÑ ŸÑŸäŸÅŸÑ ---
        let baseHp = 100;
        b.hp = baseHp * Math.pow(1.15, state.stage - 1); 
        b.max = b.hp;

        let icon = bossIcons[(state.stage - 1) % bossIcons.length];
        b.innerHTML = `<div class="hp-bar"><div class="hp-fill"></div></div><div class="boss-art">${icon}</div>`;
        b.style.top = '70px'; b.style.left = '50%'; b.style.transform = 'translateX(-50%)';
        document.body.appendChild(b);

        let bSpeed = 1.5 + (state.stage * 0.5);
        let bMove = setInterval(() => {
            if(!active) { clearInterval(bMove); return; }
            bx += bSpeed * bd; if(bx > 85 || bx < 15) bd *= -1;
            b.style.left = bx + '%';
            
            let shootLimit = 0.94 - (state.stage * 0.01);
            if(Math.random() > Math.max(0.80, shootLimit)) bossShoot(bx);
        }, 50);
    }

    function bossShoot(x) {
        const bomb = document.createElement('div');
        bomb.style.cssText = `position:absolute; width:22px; height:22px; background:white; border-radius:50%; border:3px solid var(--red); z-index:150;`;
        bomb.style.left = x + 'vw'; bomb.style.top = '170px';
        document.body.appendChild(bomb);
        
        let m = setInterval(() => {
            let t = parseFloat(bomb.style.top); 
            // --- ÿ™ÿπÿØŸäŸÑ ÿ¢ÿ≥ÿ±: ÿ≤ŸäÿßÿØÿ© ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ∑ŸÑŸÇÿßÿ™ 5% ŸÉŸÑ ŸÑŸäŸÅŸÑ ---
            let baseBulletSpeed = 8;
            let currentBulletSpeed = baseBulletSpeed * Math.pow(1.05, state.stage - 1);
            
            bomb.style.top = (t + currentBulletSpeed) + 'px';
            
            let pR = document.getElementById('player').getBoundingClientRect();
            let bR = bomb.getBoundingClientRect();
            if(bR.left < pR.right && bR.right > pR.left && bR.top < pR.bottom && bR.bottom > pR.top) {
                lives--; updateUI(); bomb.remove(); clearInterval(m); if(lives <= 0) location.reload();
            }
            if(t > window.innerHeight) { bomb.remove(); clearInterval(m); }
        }, 20);
    }

    let mL = false, mR = false;
    document.getElementById('lBtn').ontouchstart = (e) => { e.preventDefault(); mL = true; };
    document.getElementById('lBtn').ontouchend = () => mL = false;
    document.getElementById('rBtn').ontouchstart = (e) => { e.preventDefault(); mR = true; };
    document.getElementById('rBtn').ontouchend = () => mR = false;
    
    setInterval(() => {
        if(!active) return;
        if(mL && px > 8) px -= 6; if(mR && px < 92) px += 6;
        document.getElementById('player').style.left = px + '%';
    }, 20);

    updateLobbyUI();
</script>
</body>
</html>
