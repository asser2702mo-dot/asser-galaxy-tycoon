<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asser Galaxy: 20 Stages of War</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f2ff; --neon-purple: #bc13fe; --gold: #ffd700; --red: #ff0044; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; touch-action: none; color: white; user-select: none; }
        #bg { position: fixed; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at center, #050515 0%, #000 100%); }
        .overlay { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 500; background: rgba(0,0,0,0.9); }
        h1 { font-size: 30px; color: var(--neon-blue); text-shadow: 0 0 20px var(--neon-blue); text-align: center; }
        
        /* ÿßŸÑÿ¨ÿ±ÿßÿ¨ (ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ≥ŸÅŸÜ) */
        .ship-selector { display: flex; gap: 20px; margin: 20px; }
        .ship-card { border: 2px solid #333; padding: 15px; border-radius: 10px; cursor: pointer; text-align: center; transition: 0.3s; width: 80px; }
        .ship-card.active { border-color: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue); background: rgba(0,242,255,0.1); }
        
        .stats { background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 20px; margin: 10px; color: var(--gold); }
        .btn { padding: 12px 30px; font-size: 18px; color: white; border: 2px solid var(--neon-blue); background: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:disabled { border-color: #555; color: #555; }

        /* ÿßŸÑŸÑÿπÿ®ÿ© */
        #game-container { display: none; width: 100vw; height: 100vh; position: relative; }
        #player { position: absolute; bottom: 80px; font-size: 50px; z-index: 100; transform: translateX(-50%); text-shadow: 0 0 15px var(--neon-blue); }
        .bullet { position: absolute; width: 4px; height: 15px; background: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue); border-radius: 2px; z-index: 90; }
        .enemy { position: absolute; font-size: 35px; z-index: 80; }
        .boss { position: absolute; font-size: 100px; z-index: 85; text-align: center; }
        .hp-bar { width: 100px; height: 6px; background: #333; border-radius: 3px; position: absolute; top: -15px; left: 0; }
        .hp-fill { height: 100%; background: var(--red); width: 100%; }
        #ui-top { position: absolute; top: 10px; width: 100%; padding: 0 20px; box-sizing: border-box; display: flex; justify-content: space-between; z-index: 600; }
    </style>
</head>
<body>

<div id="bg"></div>

<div id="lobby" class="overlay">
    <h1>ASSER GALAXY V14<br><span style="font-size:15px; color:white;">20 STAGES OF WAR</span></h1>
    <div class="stats">üí∞ COINS: <span id="l-coins">0</span> | STAGE: <span id="l-stage">1</span>/20</div>
    
    <div style="color:var(--gold); font-size:12px;">CHOOSE YOUR SHIP:</div>
    <div class="ship-selector" id="ship-selector">
        <div class="ship-card active" onclick="selectShip(0)">üõ∏<br>Lvl <span id="lv-0">1</span></div>
        <div class="ship-card" onclick="selectShip(1)">üöÄ<br>Lvl <span id="lv-1">1</span></div>
        <div class="ship-card" onclick="selectShip(2)">‚úàÔ∏è<br>Lvl <span id="lv-2">1</span></div>
    </div>
    
    <button class="btn" onclick="upgradeShip()" id="up-btn">UPGRADE SHIP (500 üí∞)</button>
    <button class="btn" style="background:var(--neon-blue); color:black;" onclick="startGame()">START MISSION</button>
</div>

<div id="msg-screen" class="overlay" style="display:none;">
    <h1 id="msg-title">MISSION FAILED</h1>
    <button class="btn" onclick="location.reload()">CONTINUE</button>
</div>

<div id="game-container">
    <div id="ui-top">
        <div>‚ù§Ô∏è <span id="g-lives">3</span> | üí∞ <span id="g-coins">0</span></div>
        <div style="color:var(--neon-blue)">STAGE <span id="g-stage">1</span></div>
    </div>
    <div id="player">üõ∏</div>
</div>

<script>
    // ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©
    let coins = parseInt(localStorage.getItem('a_coins')) || 0;
    let stage = parseInt(localStorage.getItem('a_stage')) || 1;
    let currentShipIdx = 0;
    let shipLevels = JSON.parse(localStorage.getItem('a_ships')) || [1, 1, 1];
    let shipIcons = ['üõ∏', 'üöÄ', '‚úàÔ∏è'];
    let bossIcons = ['üëæ', 'üëπ', 'üë∫', 'üê≤']; // Ÿàÿ≠ÿ¥ ŸÑŸÉŸÑ 5 ŸÖÿ±ÿßÿ≠ŸÑ

    let gameActive = false;
    let lives = 3;
    let enemiesKilled = 0;
    let isBossTime = false;

    function saveData() {
        localStorage.setItem('a_coins', coins);
        localStorage.setItem('a_stage', stage);
        localStorage.setItem('a_ships', JSON.stringify(shipLevels));
    }

    function updateLobby() {
        document.getElementById('l-coins').innerText = coins;
        document.getElementById('l-stage').innerText = stage;
        document.getElementById('up-btn').innerText = `UPGRADE ${shipIcons[currentShipIdx]} (Lvl ${shipLevels[currentShipIdx]}) - ${shipLevels[currentShipIdx]*500}üí∞`;
        for(let i=0; i<3; i++) {
            document.getElementById(`lv-${i}`).innerText = shipLevels[i];
        }
        saveData();
    }

    function selectShip(idx) {
        currentShipIdx = idx;
        const cards = document.querySelectorAll('.ship-card');
        cards.forEach((c, i) => c.className = i === idx ? 'ship-card active' : 'ship-card');
        document.getElementById('player').innerText = shipIcons[idx];
        updateLobby();
    }

    function upgradeShip() {
        let cost = shipLevels[currentShipIdx] * 500;
        if(coins >= cost && shipLevels[currentShipIdx] < 5) {
            coins -= cost;
            shipLevels[currentShipIdx]++;
            updateLobby();
        } else { alert("Not enough coins or Max Level!"); }
    }

    // ŸÖŸäŸÉÿßŸÜŸäŸÉÿß ÿßŸÑŸÑÿπÿ®ÿ©
    function startGame() {
        document.getElementById('lobby').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        gameActive = true;
        enemiesKilled = 0;
        lives = 3 + shipLevels[currentShipIdx];
        isBossTime = false;
        document.getElementById('g-stage').innerText = stage;
        document.getElementById('g-coins').innerText = coins;
        document.getElementById('g-lives').innerText = lives;
        
        spawnLoop();
        shootLoop();
    }

    // ÿ≠ÿ±ŸÉÿ© ÿßŸÑŸÑÿßÿπÿ®
    window.addEventListener('touchmove', (e) => {
        if(!gameActive) return;
        document.getElementById('player').style.left = e.touches[0].clientX + 'px';
    });

    // ÿ•ÿ∑ŸÑÿßŸÇ ÿßŸÑŸÜÿßÿ± ÿßŸÑÿ£Ÿàÿ™ŸàŸÖÿßÿ™ŸäŸÉŸä
    function shootLoop() {
        if(!gameActive) return;
        const p = document.getElementById('player').getBoundingClientRect();
        const b = document.createElement('div');
        b.className = 'bullet';
        b.style.left = (p.left + p.width/2 - 2) + 'px';
        b.style.bottom = (window.innerHeight - p.top) + 'px';
        document.getElementById('game-container').appendChild(b);

        let moveB = setInterval(() => {
            let bottom = parseFloat(b.style.bottom);
            b.style.bottom = (bottom + 10) + 'px';
            
            // ÿ™ÿµÿßÿØŸÖ ÿßŸÑÿ±ÿµÿßÿµÿ© ŸÖÿπ ÿßŸÑÿ£ÿπÿØÿßÿ°
            document.querySelectorAll('.enemy, .boss').forEach(en => {
                let r1 = b.getBoundingClientRect();
                let r2 = en.getBoundingClientRect();
                if(r1.left < r2.right && r1.right > r2.left && r1.top < r2.bottom && r1.bottom > r2.top) {
                    if(en.classList.contains('boss')) {
                        en.hp -= (1 * shipLevels[currentShipIdx]);
                        en.querySelector('.hp-fill').style.width = (en.hp/en.maxHp*100) + '%';
                        if(en.hp <= 0) {
                            en.remove(); coins += 200; stage++; finishStage(true);
                        }
                    } else {
                        en.remove(); coins += 10; enemiesKilled++;
                        document.getElementById('g-coins').innerText = coins;
                        if(enemiesKilled >= 10 && !isBossTime) spawnBoss();
                    }
                    b.remove(); clearInterval(moveB);
                }
            });

            if(bottom > window.innerHeight) { b.remove(); clearInterval(moveB); }
        }, 20);

        setTimeout(shootLoop, 400 - (shipLevels[currentShipIdx] * 50));
    }

    function spawnLoop() {
        if(!gameActive || isBossTime) return;
        const en = document.createElement('div');
        en.className = 'enemy';
        en.innerText = 'üëæ';
        en.style.left = Math.random()*90 + 'vw';
        en.style.top = '-50px';
        document.getElementById('game-container').appendChild(en);

        let moveEn = setInterval(() => {
            if(!gameActive) { en.remove(); clearInterval(moveEn); return; }
            let top = parseFloat(en.style.top);
            en.style.top = (top + 3 + (stage/5)) + 'px';
            
            if(top > window.innerHeight) {
                lives--; document.getElementById('g-lives').innerText = lives;
                en.remove(); clearInterval(moveEn);
                if(lives <= 0) finishStage(false);
            }
        }, 20);
        setTimeout(spawnLoop, 1500 - (stage*50));
    }

    function spawnBoss() {
        isBossTime = true;
        const boss = document.createElement('div');
        boss.className = 'boss';
        boss.hp = 20 * (stage/5);
        boss.maxHp = boss.hp;
        boss.innerText = bossIcons[Math.floor((stage-1)/5)];
        boss.innerHTML += `<div class="hp-bar"><div class="hp-fill"></div></div>`;
        boss.style.left = '35%'; boss.style.top = '50px';
        document.getElementById('game-container').appendChild(boss);
    }

    function finishStage(win) {
        gameActive = false;
        document.getElementById('game-container').style.display = 'none';
        document.getElementById('msg-screen').style.display = 'flex';
        document.getElementById('msg-title').innerText = win ? "STAGE CLEAR!" : "MISSION FAILED";
        document.getElementById('msg-title').style.color = win ? "var(--neon-blue)" : "var(--red)";
        saveData();
    }

    updateLobby();
</script>
</body>
</html>
